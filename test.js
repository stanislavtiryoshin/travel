const hotel = {
  kids: {
    kidDiscount: { discountType: "В процентах", discountValue: 3000 },
    babyMaxAge: 6,
    kidMaxAge: 17,
  },
  payment: { paymentType: "Оплата за человека", prepayment: 40 },
  _id: "642c1d309c9dbb366d03b702",
  name: "Патавия",
  locationId: {
    locationDescription:
      "Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum.",
    _id: "64198edbf998c0918dc85d7e",
    locationName: "Атырау",
    locationCountry: "Казахстан",
    description:
      "Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum. Lorem ipsum dolor sit amet, id dicant splendide cum.",
  },
  locationFeature: "20 км от центра города",
  mapLink: "тугис",
  food: {
    _id: "642150a586cfa75278c280b9",
    label: "Без питания",
    value: "Без питания",
  },
  kidFoodPrice: 2000,
  adultFoodPrice: 3000,
  comforts: ["642150a586cfa75278c280b9"],
  rating: 5,
  hotelStars: 5,
  description:
    "Lorem ipsum dolor, sit amet consectetur adipisicing elit. Repellat fugit delectus sunt, accusantium, dolore laudantium quibusdam animi commodi nostrum incidunt neque, consectetur ab consequatur vero nemo fuga itaque deleniti corrupti!",
  enterTime: "07:00",
  leaveTime: "10:00",
  hotelServices: [
    {
      _id: "643d53e9166fe9cd5e1554ff",
      hotelServiceName: "Парковка",
      category: {
        _id: "643d5377166fe9cd5e1554fd",
        categoryName: "Дополнительно",
      },
      icon: '<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M10.5712 6.38829H8.7002V9.84717H10.5712C11.5248 9.84717 12.3006 9.07135 12.3006 8.11773C12.3006 7.16411 11.5248 6.38829 10.5712 6.38829Z" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10.5705 9.84714H8.69949V6.38826H10.5705C11.5241 6.38826 12.2999 7.16408 12.2999 8.1177C12.2999 9.07132 11.5241 9.84714 10.5705 9.84714ZM10.5705 4.38409H7.6974C7.14395 4.38409 6.69531 4.83276 6.69531 5.38618V15.6157H8.69949V11.8513H10.5705C12.6292 11.8513 14.3041 10.1764 14.3041 8.1177C14.3041 6.05898 12.6292 4.38409 10.5705 4.38409Z" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M16.3789 18H4.62109C3.44965 18 2.5 17.0504 2.5 15.8789V4.12109C2.5 2.94964 3.44965 2 4.62109 2H16.3789C17.5504 2 18.5 2.94964 18.5 4.12109V15.8789C18.5 17.0504 17.5504 18 16.3789 18Z" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',
      priority: 1,
    },
    {
      _id: "643d5390166fe9cd5e1554fe",
      hotelServiceName: "Кондиционер",
      category: {
        _id: "643d5377166fe9cd5e1554fd",
        categoryName: "Дополнительно",
      },
      icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M2.01172 14.6094L10 10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M2.66113 11.6859L5.67965 12.4947L4.87082 15.5132" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M17.9883 5.39062L10 10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M15.1291 4.48715L14.3203 7.50566L17.3388 8.31445" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10 19.2188V10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M7.79004 17.1987L9.99973 14.989L12.2095 17.1987" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M10 0.78125V10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M7.79004 2.80154L9.99973 5.01123L12.2095 2.80154" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M17.9883 14.6094L10 10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M15.1291 15.5132L14.3203 12.4947L17.3388 11.6859" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M2.01172 5.39062L10 10" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M2.66113 8.31445L5.67965 7.50563L4.87082 4.48715" stroke="#2569D7" stroke-width="1.2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',
      priority: 1,
    },
    {
      _id: "64258af02ba7928f871a09cd",
      hotelServiceName: "Ресторан при отеле",
      category: { _id: "642587032ba7928f871a09ca", categoryName: "Питание" },
      priority: 1,
      icon: '<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1.06959 14.4481H16.5731C16.5743 14.4499 16.5756 14.4524 16.5768 14.4555C16.5792 14.4616 16.5808 14.4692 16.5808 14.4777C16.5808 14.4862 16.5792 14.4938 16.5768 14.4999C16.5756 14.503 16.5742 14.5054 16.5731 14.5072H1.06959C1.06845 14.5054 1.06714 14.503 1.06592 14.4999C1.06354 14.4938 1.06191 14.4862 1.06191 14.4777C1.06191 14.4692 1.06354 14.4616 1.06592 14.4555C1.06714 14.4524 1.06845 14.4499 1.06959 14.4481Z" stroke="#2569D7" stroke-width="1.2"/>\n<path d="M7.28979 7.88906L7.29258 7.88648L7.28979 7.88906ZM7.28979 7.88906L7.28756 7.8911L7.28979 7.88906ZM5.4862 9.58073C5.88967 8.81729 6.52505 8.23197 7.2787 7.915C7.27884 7.91536 7.27899 7.91573 7.27913 7.91611C7.28149 7.92239 7.283 7.93011 7.28289 7.93855C7.28278 7.94698 7.28108 7.95453 7.27865 7.96051C7.27637 7.9661 7.2739 7.96929 7.27265 7.97064C6.50986 8.28573 5.87984 8.86449 5.48096 9.60243C5.48102 9.60132 5.48111 9.60021 5.48123 9.59909C5.48212 9.59085 5.48443 9.5841 5.48696 9.57929L4.95572 9.30039L5.4862 9.58073Z" stroke="#2569D7" stroke-width="1.2"/>\n<path d="M9.27517 3.61485C9.25342 3.66089 9.22414 3.70436 9.18734 3.7433C9.18734 3.7433 9.18734 3.74331 9.18733 3.74331C9.1847 3.7461 9.18203 3.74885 9.17933 3.75158C9.11085 3.82073 9.02129 3.87042 8.92119 3.89054C8.88891 3.89703 8.85552 3.90044 8.8214 3.90044C8.75296 3.90044 8.68673 3.88661 8.62614 3.86124L8.78345 3.5023M9.27517 3.61485L9.24626 3.1433L9.24625 3.14328C9.21045 3.0866 9.16234 3.03607 9.10383 2.99656C9.07912 2.97987 9.05256 2.96515 9.0243 2.95276C9.02429 2.95276 9.02429 2.95276 9.02428 2.95276C8.96039 2.92476 8.89125 2.91029 8.8214 2.91029C8.78665 2.91028 8.75172 2.91386 8.71717 2.92113C8.6175 2.94211 8.53015 2.99179 8.46346 3.05915L8.75128 3.33117M9.27517 3.61485C9.28893 3.57728 9.29893 3.53825 9.30506 3.49847C9.30979 3.46777 9.31221 3.43663 9.31227 3.40537C9.31236 3.35909 9.30728 3.31256 9.29686 3.26684C9.29321 3.25087 9.28897 3.23522 9.28417 3.21992C9.28251 3.21463 9.28078 3.20939 9.27899 3.20419L9.27517 3.61485ZM8.78345 3.5023C8.79554 3.5076 8.80844 3.51029 8.8214 3.51029C8.82786 3.51029 8.83434 3.50962 8.84074 3.50827M8.78345 3.5023C8.77413 3.49822 8.76552 3.49268 8.75786 3.48592M8.78345 3.5023L8.62614 3.86123C8.59216 3.847 8.55996 3.82914 8.53013 3.80805L8.75786 3.48592M8.84074 3.50827L8.84083 3.50868L8.84074 3.50827ZM8.84074 3.50827C8.85998 3.50422 8.87765 3.49423 8.89152 3.47956C8.89416 3.47676 8.89664 3.47382 8.89895 3.47075C8.90878 3.4577 8.91556 3.44231 8.91866 3.42583C8.91993 3.41906 8.92056 3.41221 8.92056 3.40537C8.92056 3.39165 8.91802 3.378 8.91301 3.36521C8.91182 3.36215 8.91048 3.35916 8.90903 3.35625C8.90903 3.35625 8.90903 3.35625 8.90903 3.35625C8.90136 3.34093 8.89019 3.32781 8.87649 3.31812C8.87336 3.31591 8.87013 3.3139 8.86681 3.31209C8.85281 3.30446 8.83725 3.30044 8.8214 3.30044C8.81332 3.30044 8.80535 3.30148 8.79764 3.3035C8.78023 3.30804 8.76416 3.31754 8.75128 3.33117M8.75128 3.33117L8.46346 3.05916C8.46076 3.06188 8.45809 3.06464 8.45546 3.06743L8.74384 3.33998M8.75128 3.33117C8.74863 3.33397 8.74615 3.33692 8.74384 3.33998M8.74384 3.33998L8.45545 3.06743C8.41675 3.10838 8.3863 3.15448 8.3642 3.20332C8.35709 3.22385 8.35101 3.24505 8.34604 3.26684C8.34229 3.28329 8.33922 3.29985 8.33685 3.31646C8.33262 3.34601 8.33056 3.37574 8.33062 3.40537C8.33074 3.46576 8.33967 3.52571 8.35702 3.58287C8.36037 3.59389 8.36403 3.60481 8.368 3.6156C8.37789 3.63643 8.38932 3.65672 8.40225 3.67627L8.73894 3.46366M8.74384 3.33998C8.73311 3.35423 8.72608 3.37118 8.72342 3.38913C8.72264 3.39447 8.72223 3.3999 8.72223 3.40537C8.72223 3.4165 8.72391 3.42751 8.72714 3.43798C8.72994 3.44702 8.7339 3.45566 8.73894 3.46366M8.73894 3.46366L8.40226 3.67628C8.43529 3.72621 8.47812 3.77129 8.53012 3.80805L8.75786 3.48592M8.73894 3.46366C8.74424 3.47204 8.75062 3.47953 8.75786 3.48592M16.2862 11.8004H17.0353C17.0365 11.8022 17.0378 11.8046 17.039 11.8078C17.0414 11.8139 17.043 11.8215 17.043 11.83C17.043 11.8385 17.0414 11.8461 17.039 11.8522C17.0378 11.8553 17.0365 11.8577 17.0353 11.8595H0.607681C0.606531 11.8577 0.605231 11.8553 0.604003 11.8522C0.601623 11.8461 0.6 11.8385 0.6 11.83C0.6 11.8215 0.601623 11.8139 0.604003 11.8078C0.605231 11.8046 0.606531 11.8022 0.60768 11.8004H1.35669H1.88661H1.9091H2.55045H15.0923H15.7338H15.7562H16.2862ZM8.8214 5.07234C6.06651 5.07234 3.67261 6.65832 2.5686 8.95625C3.60177 6.76327 5.78893 5.19759 8.36295 5.03004L8.82145 5.00019L9.27994 5.03004C11.8607 5.19803 14.0526 6.77135 15.0824 8.97346C13.9821 6.66624 11.5832 5.07234 8.8214 5.07234Z" stroke="#2569D7" stroke-width="1.2"/>\n</svg>\n',
    },
    {
      priority: 0,
      _id: "64188dcc2648843412b1297f",
      hotelServiceName: "Спа",
      category: { _id: "6425871c2ba7928f871a09cb", categoryName: "Досуг" },
    },
    {
      priority: 0,
      _id: "64258b392ba7928f871a09ce",
      hotelServiceName: "Бильярд",
      category: { _id: "6425871c2ba7928f871a09cb", categoryName: "Досуг" },
    },
  ],
  rooms: [
    {
      beds: { bedsType: "", largeBeds: null, smallBeds: null },
      people: { adultMax: null, babyMax: null, kidsMax: null },
      bathroom: { availablity: "", type: "", features: [] },
      img: [],
      _id: "642a6192ca6de00b28dab5d5",
      hotel: "642c1d309c9dbb366d03b702",
      roomName: "Стандарт 2-местный",
      roomType: "",
      capacity: 2,
      extraPlaces: [
        {
          _id: 0,
          minAge: 6,
          maxAge: 17,
          isKid: true,
          priceWithFood: 1000,
          priceNoFood: 800,
          foodPrice: 300,
        },
        {
          _id: 1,
          minAge: 18,
          maxAge: 10000,
          isKid: false,
          priceWithFood: 1200,
          priceNoFood: 1000,
          foodPrice: 300,
        },
      ],
      basePrice: 0,
      area: 20,
      smokingPolicy: "",
      roomsNumber: null,
      restroom: "",
      comforts: [],
      comment: "",
      roomDescription: "",
      roomServices: ["Кондиционер2", "Кондиционер4"],
      bathExtras: ["Полотенца2", "Полотенца"],
      createdAt: "2023-04-03T05:18:10.261Z",
      updatedAt: "2023-04-23T15:02:21.264Z",
      __v: 0,
      periodPrices: [
        {
          period: {
            _id: "6441096e3a8977ab71fe4a31",
            hotel: "642c1d309c9dbb366d03b702",
            startDay: 1,
            startMonth: 1,
            endDay: 1,
            endMonth: 2,
            createdAt: "2023-04-20T09:44:14.443Z",
            updatedAt: "2023-04-20T09:44:14.443Z",
            __v: 0,
          },
          roomPrice: 10000,
          adultPrice: 6000,
          kidPrice: 3000,
          _id: "6441096e3a8977ab71fe4a37",
        },
        {
          period: {
            _id: "6441096e3a8977ab71fe4a32",
            hotel: "642c1d309c9dbb366d03b702",
            startDay: 2,
            startMonth: 2,
            endDay: 2,
            endMonth: 3,
            createdAt: "2023-04-20T09:44:14.444Z",
            updatedAt: "2023-04-20T09:44:14.444Z",
            __v: 0,
          },
          roomPrice: 20000,
          adultPrice: 7000,
          kidPrice: 5000,
          _id: "6441096e3a8977ab71fe4a39",
        },
      ],
    },
  ],
  program: [],
  createdAt: "2023-04-04T12:50:56.814Z",
  updatedAt: "2023-04-23T15:02:21.085Z",
  __v: 0,
  periods: [
    {
      _id: "6441096e3a8977ab71fe4a31",
      hotel: "642c1d309c9dbb366d03b702",
      startDay: 1,
      startMonth: 1,
      endDay: 1,
      endMonth: 2,
      createdAt: "2023-04-20T09:44:14.443Z",
      updatedAt: "2023-04-20T09:44:14.443Z",
      __v: 0,
    },
    {
      _id: "6441096e3a8977ab71fe4a32",
      hotel: "642c1d309c9dbb366d03b702",
      startDay: 2,
      startMonth: 2,
      endDay: 2,
      endMonth: 3,
      createdAt: "2023-04-20T09:44:14.444Z",
      updatedAt: "2023-04-20T09:44:14.444Z",
      __v: 0,
    },
    {
      _id: "6445487c6e8205dc2801b9c0",
      hotel: "642c1d309c9dbb366d03b702",
      startDay: 2,
      startMonth: 2,
      endDay: 2,
      endMonth: 3,
      createdAt: "2023-04-23T15:02:20.892Z",
      updatedAt: "2023-04-23T15:02:20.892Z",
      __v: 0,
    },
    {
      _id: "6445487c6e8205dc2801b9bf",
      hotel: "642c1d309c9dbb366d03b702",
      startDay: 1,
      startMonth: 1,
      endDay: 1,
      endMonth: 2,
      createdAt: "2023-04-23T15:02:20.891Z",
      updatedAt: "2023-04-23T15:02:20.891Z",
      __v: 0,
    },
  ],
  img: [
    "http://localhost:5000/images/Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑÐ°Ð½Ð° (293).png-1681666787645.jpg",
    "http://localhost:5000/images/Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑÐ°Ð½Ð° (294).png-1681666787682.jpg",
    "http://localhost:5000/images/Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑÐ°Ð½Ð° (295).png-1681666787702.jpg",
    "http://localhost:5000/images/Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑÐ°Ð½Ð° (296).png-1681666787784.jpg",
    "http://localhost:5000/images/Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑÐ°Ð½Ð° (297).png-1681666787840.jpg",
  ],
  foodIncluded: false,
};

const getPrice = () => {
  const ages = [1000, 1000, 6, 15];
  const roomId = "642a6192ca6de00b28dab5d5";
  const daysAmount = 3;
  const addExtraFood = false;
  const addRoomFood = true;
  const start = 1674259200;
  const personMode = true;
  const kidsFoodAmount = 0;
  const adultsFoodAmount = 2;

  let sum = 0;
  let chosenPlaces = [];

  const chosenRoom = hotel.rooms.find((room) => room._id === roomId);
  const extraPlacesAmount = ages.length - chosenRoom.capacity;

  let placesArray = chosenRoom.extraPlaces;

  ages.sort((a, b) => b - a);

  const accomodatedAges = ages.splice(0, extraPlacesAmount);

  console.log(ages, "ages");

  const notChosen = (place) => !chosenPlaces.some((el) => el._id === place._id);

  ages.forEach((age) => {
    const matchingPlace = placesArray.find((place) => {
      if (age !== 1000 && notChosen(place)) {
        return true;
      } else if (age === 1000 && !place.isKid && notChosen(place)) {
        return true;
      } else {
        return false;
      }
    });
    if (matchingPlace) {
      chosenPlaces.push(matchingPlace);
    }
  });

  if (ages.length > chosenRoom.capacity + chosenPlaces.length)
    return "This room can't fit all these tenants";

  sum = chosenPlaces.reduce((acc, place) => {
    if (addExtraFood) {
      return acc + (place.priceNoFood + place.foodPrice) * daysAmount;
    } else if (!addExtraFood) {
      return acc + place.priceNoFood * daysAmount;
    } else {
      return acc + place.priceWithFood * daysAmount;
    }
  }, 0);

  (function calculatePrice(start, daysNum, basePrice, pricesArray) {
    let daysArray = [];
    const startingDate = new Date(+start);

    for (let i = 0; i < daysNum; i++) {
      let date = new Date(startingDate.getTime());
      date.setDate(startingDate.getDate() + i);
      daysArray.push(date);
    }

    const findPriceByDate = (date) => {
      if (pricesArray && pricesArray.length > 0) {
        let priceFound = false;
        pricesArray.forEach((el) => {
          const startMonth = el.period.startMonth;
          const startDay = el.period.startDay;
          const endMonth = el.period.endMonth;
          const endDay = el.period.endDay;

          if (
            (date.getMonth() + 1 > startMonth ||
              (date.getMonth() + 1 === startMonth &&
                date.getDate() >= startDay)) &&
            (date.getMonth() + 1 < endMonth ||
              (date.getMonth() + 1 === endMonth && date.getDate() <= endDay))
          ) {
            if (!personMode) {
              sum += el.roomPrice;
              priceFound = true;
            } else {
              accomodatedAges.forEach((age) => {
                if (age === 1000) {
                  sum += el.adultPrice;
                  console.log("sum += el.adultPrice");
                } else {
                  sum += el.kidPrice;
                  console.log("sum += el.kidPrice;");
                }
              });
              priceFound = true;
            }
          }
        });
        if (!priceFound) {
          sum += basePrice;
          console.log("!priceFound");
        }
      } else {
        sum += basePrice;
        console.log("else");
      }
      console.log(sum);
    };

    (function calculateFood() {
      if (addRoomFood) {
        accomodatedAges.forEach((age) => {
          if (age === 1000) sum += hotel.adultFoodPrice;
          else if (age >= kids.kidMaxAge) sum += hotel.kidFoodPrice;
        });
      }
    })();

    for (let i = 0; i < daysNum; i++) {
      findPriceByDate(daysArray[i]);
    }
  })(start, daysAmount, 2, chosenRoom.periodPrices);

  return sum;
};

console.log(getPrice());
